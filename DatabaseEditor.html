<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>Editable Entity-Attribute Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .actions {
            margin-top: 10px;
        }
        .actions input, .actions button {
            margin-right: 10px;
            padding: 5px 10px;
        }



    </style>
</head>
<body>
    <h1>Editable Entity-Attribute Viewer</h1>
    <input type="file" id="fileInput" accept=".json">
    <div id="tables-container">
        <!-- Dynamic tables for each entity -->
    </div>
    <button id="saveChanges" style="margin-top: 20px;">Save Changes</button>

    
    <script>
        let jsonData = {};

        // Handle file input
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                jsonData = JSON.parse(e.target.result);
                displayEntities(jsonData);
            };
            reader.readAsText(file);
        });

        // Display tables for entities
        function displayEntities(data) {
            const container = document.getElementById("tables-container");
            container.innerHTML = ""; // Clear any previous content

            for (const [entityType, entities] of Object.entries(data.entities || {})) {
                // Create a table for each entity type
                const table = document.createElement("table");
                const caption = document.createElement("caption");
                caption.textContent = `Entity Type: ${entityType}`;
                table.appendChild(caption);

                // Extract all attribute keys from entities
                const headers = Object.keys(Object.values(entities)[0] || {});
                const thead = document.createElement("thead");
                const headerRow = document.createElement("tr");
                headerRow.innerHTML = `<th>Entity ID</th>${headers.map(attr => `<th>${attr}</th>`).join("")}<th>Actions</th>`;
                thead.appendChild(headerRow);
                table.appendChild(thead);

                // Populate rows
                const tbody = document.createElement("tbody");
                for (const [entityId, attributes] of Object.entries(entities)) {
                    const row = createRow(entityType, entityId, attributes, headers);
                    tbody.appendChild(row);
                }
                table.appendChild(tbody);

                // Add row button
                const addRowDiv = document.createElement("div");
                addRowDiv.classList.add("actions");
                addRowDiv.innerHTML = `
                    <button onclick="addRow('${entityType}')">Add Row</button>
                    <button onclick="addColumn('${entityType}')">Add Column</button>
                    <button onclick="removeColumn('${entityType}')">Remove Column</button>
                `;

                // Append table and actions to container
                container.appendChild(table);
                container.appendChild(addRowDiv);
            }
        }

        // Create a table row dynamically
        function createRow(entityType, entityId, attributes, headers) {
            const row = document.createElement("tr");

            // Entity ID
            const idCell = document.createElement("td");
            idCell.textContent = entityId;
            row.appendChild(idCell);

            // Attribute cells
            headers.forEach(attr => {
                const cell = document.createElement("td");
                cell.contentEditable = true;
                cell.textContent = attributes[attr] || "";
                cell.addEventListener("blur", () => updateCell(entityType, entityId, attr, cell.textContent));
                row.appendChild(cell);
            });

            // Action buttons
            const actionsCell = document.createElement("td");
            actionsCell.innerHTML = `
                <button onclick="deleteRow('${entityType}', '${entityId}')">Delete</button>
            `;
            row.appendChild(actionsCell);

            return row;
        }

        // Add a new row
        function addRow(entityType) {
            const entityId = prompt("Enter new entity ID:");
            if (!entityId) return;

            const entityData = jsonData.entities[entityType];
            const headers = Object.keys(Object.values(entityData)[0] || {});
            const newRowData = {};
            headers.forEach(header => (newRowData[header] = ""));

            jsonData.entities[entityType][entityId] = newRowData;
            displayEntities(jsonData);
        }

        // Add a new column
        function addColumn(entityType) {
            const columnName = prompt("Enter new column name:");
            if (!columnName) return;

            const entityData = jsonData.entities[entityType];
            Object.keys(entityData).forEach(entityId => {
                jsonData.entities[entityType][entityId][columnName] = "";
            });

            displayEntities(jsonData);
        }

        // Remove a column
        function removeColumn(entityType) {
            const columnName = prompt("Enter column name to remove:");
            if (!columnName) return;

            const entityData = jsonData.entities[entityType];
            Object.keys(entityData).forEach(entityId => {
                delete jsonData.entities[entityType][entityId][columnName];
            });

            displayEntities(jsonData);
        }

        // Update a cell
        function updateCell(entityType, entityId, attr, value) {
            jsonData.entities[entityType][entityId][attr] = value;
        }

        // Delete a row
        function deleteRow(entityType, entityId) {
            if (!confirm(`Are you sure you want to delete entity "${entityId}"?`)) return;
            delete jsonData.entities[entityType][entityId];
            displayEntities(jsonData);
        }

        // Save changes to file
        document.getElementById("saveChanges").addEventListener("click", function() {
            const jsonString = JSON.stringify(jsonData, null, 2);
            const blob = new Blob([jsonString], { type: "application/json" });
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "updated_data.json";
            a.click();
        });
    </script>
</body>
</html>
