<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v6.1.1/dist/aframe-extras.loaders.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="Styles.css">

    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <div class="container">
        <div class="logo-container">
            <!-- First logo -->
            <img src="asset/University_of_Malaya-Logo.png" alt="UM Logo" class="logoTop">
            <img src="asset/UM.AR_Logo_Font_Black.png" alt="UM AR Logo" class="logoTop">
        </div>

        <a href="https://um-ar.netlify.app/main.html" class="backButton">
            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white"
                class="bi bi-arrow-left-circle-fill" viewBox="0 0 16 16">
                <path
                    d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0m3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5z" />
            </svg>
        </a>
    </div>
    <div id="data-container" class="data-container" style="display:none;">
        <p id="userLocation" style="font-size:10px; top: 5px;  color: white; padding: 5px;"></p>
    </div>

    <div id="Loading" class="box">
        <div class="cat">
            <div class="cat__body"></div>
            <div class="cat__body"></div>
            <div class="cat__tail"></div>
            <div class="cat__head"></div>
        </div>
    </div>

    <div id="proximity-message" style="
    position: fixed;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    text-align: center;
    display: none;
    z-index: 1000;
    transition: opacity 0.5s ease-in-out;
    ">
    </div>

    <div id="camera-facing-message" style="
    position: fixed;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    text-align: center;
    display: none;
    z-index: 1000;
    transition: opacity 0.5s ease-in-out;
    "></div>

    <div id="debug-message" style="
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 10px 20px;
    border-radius: 10px;
    font-family: Arial, sans-serif;
    font-size: 14px;
    text-align: center;
    display: none;
    z-index: 1000;
    transition: opacity 0.5s ease-in-out;
    "></div>



    <a-scene renderer="logarithmicDepthBuffer: true;" embedded loading-screen="enabled: false;"
        arjs="sourceType: webcam; debugUIEnabled: false;">
        <a-assets>

            <img id="FSKTMLogo" src="asset/logo/Logo FSKTM.png">
            <a-asset-item id="animated-asset" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="FSKTM" src="asset/FSKTMAnim3.glb"></a-asset-item>

            <!-- Faculties -->
            <a-asset-item id="locationPinMedicine" src="asset/gltf_file/Fac_Medicine_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinEngineering"
                src="asset/gltf_file/Fac_Engineering_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinLaw" src="asset/gltf_file/Fac_Law_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinScience" src="asset/gltf_file/Fac_Science_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinCS" src="asset/gltf_file/FCSIT_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinBusiness"
                src="asset/gltf_file/Fac_Business_Econs_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinArts" src="asset/gltf_file/Fac_Art_Social_Sc_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinBuiltEnvironment"
                src="asset/gltf_file/Fac_Built_Env_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinDentistry" src="asset/gltf_file/Fac_Dentistry_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinEducation" src="asset/gltf_file/Fac_Edu_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinSport" src="asset/gltf_file/Fac_Sport_Science_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinLanguages" src="asset/gltf_file/Fac_Language_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinPharmacy" src="asset/gltf_file/Fac_Pharmacy_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinCreativeArts"
                src="asset/gltf_file/Fac_Creative_Arts_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinAkademiMelayu" src="asset/gltf_file/APM_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinAkademiIslam" src="asset/gltf_file/API_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinInstituteAdvancedStudies"
                src="asset/gltf_file/Advance_Studies_Checkpoint.glb"></a-asset-item>
            <a-asset-item id="locationPinPusatAsasi" src="asset/gltf_file/Pasum_Checkpoint.glb"></a-asset-item>

            <!-- Residential Colleges -->
            <a-asset-item id="locationPinKolej1" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej2" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej3" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej4" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej5" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej6" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej7" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej8" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej9" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej10" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej11" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej12" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKolej13" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinRumahUniversiti" src="asset/LocationPin.glb"></a-asset-item>

            <!-- Facilities -->
            <a-asset-item id="locationPinDTC" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinPanggung" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinKPS" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinBangunanCanseleri" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinExamHall" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinUMCentral" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinBankIslam" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinMasjid" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinAcademyIslam" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinTemple" src="asset/LocationPin.glb"></a-asset-item>

            <!-- Libraries -->
            <a-asset-item id="locationPinUMLibrary" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinMedicalLibrary" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinLawLibrary" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinZabaLibrary" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinDentalLibrary" src="asset/LocationPin.glb"></a-asset-item>
            <a-asset-item id="locationPinIslamicLibrary" src="asset/LocationPin.glb"></a-asset-item;>

                <!-- Sports and Recreation -->
                <a-asset-item id="locationPinUMWallSquash" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinVarsityGreen" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinUMPark" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinPadangC" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinKayaks" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinSwimmingPool" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinUMSportsCentre" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinUMArenaStadium" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinRimbaIlmu" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinLadangMini" src="asset/LocationPin.glb"></a-asset-item>
                <a-asset-item id="locationPinMustafaRiver" src="asset/LocationPin.glb"></a-asset-item>
        </a-assets>

        <a-camera gps-camera rotation-reader fov="20" near="0.1" far="1000"></a-camera>


    </a-scene>

    <script>
        // Function to show debug messages in the div
        function showDebugMessage(message) {
            const debugDiv = document.getElementById("debug-message");
            debugDiv.innerText = message; // Set the message text
            debugDiv.style.display = "block"; // Make the div visible
            debugDiv.style.opacity = "1"; // Fade-in effect
        }

        // Function to hide the debug message
        function hideDebugMessage() {
            const debugDiv = document.getElementById("debug-message");
            debugDiv.style.opacity = "0"; // Fade-out effect
            setTimeout(() => {
                debugDiv.style.display = "none"; // Hide after fade-out
            }, 500); // Match this timeout with the CSS transition duration
        }

        
    </script>



    <!-- Firebase Initialization -->
    <script type="module">

        // Display the entity's details in the debug message div
        showDebugMessage(
                        'Test debug'
                    );

                    // Automatically hide the debug message after 5 seconds (optional)
                    setTimeout(hideDebugMessage, 5000);

        

        // Firebase Initialization
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB1NEkxuhsfBrsTgfei80LWmF4o_IQwO8",
            authDomain: "um-ar-d0418.firebaseapp.com",
            databaseURL: "https://um-ar-d0418-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "um-ar-d0418",
            storageBucket: "um-ar-d0418.appspot.com",
            messagingSenderId: "624669072499",
            appId: "1:624669072499:web:315e91c12fad88513c6d52",
            measurementId: "G-XWM53Y6FBZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Fetch entities from Firebase
        async function fetchEntitiesFromFirebase() {
            const entitiesRef = ref(db, 'entities');
            onValue(entitiesRef, (snapshot) => {
                const entities = snapshot.val();
                if (!entities) {
                    console.error("No entities found in the database.");
                    return;
                }

                // Loop through entities and create <a-entity> dynamically
                Object.keys(entities).forEach((key) => {
                    const entity = entities[key];
                    if (!entity.latitude || !entity.longitude || !entity.model) {
                        console.warn(`Entity ${key} is missing required properties.`);
                        return;
                    }

                    // Create an <a-entity> element
                    const entityElement = document.createElement('a-entity');
                    entityElement.setAttribute('id', key);
                    entityElement.setAttribute('look-at', '#camera');
                    entityElement.setAttribute('gltf-model', entity.model);
                    entityElement.setAttribute('animation-mixer', 'clip: *');
                    entityElement.setAttribute('scale', entity.scale || '800 800 800');
                    entityElement.setAttribute(
                        'gps-entity-place',
                        `latitude: ${entity.latitude}; longitude: ${entity.longitude}`
                    );

                    // Display the entity's details in the debug message div
                    showDebugMessage(
                        `Created <a-entity>:\n` +
                        `ID: ${entityElement.getAttribute('id')}\n` +
                        `Look At: ${entityElement.getAttribute('look-at')}\n` +
                        `GLTF Model: ${entityElement.getAttribute('gltf-model')}\n` +
                        `Animation Mixer: ${entityElement.getAttribute('animation-mixer')}\n` +
                        `Scale: ${entityElement.getAttribute('scale')}\n` +
                        `GPS Entity Place: ${entityElement.getAttribute('gps-entity-place')}`
                    );

                    // Automatically hide the debug message after 5 seconds (optional)
                    setTimeout(hideDebugMessage, 5000);

                    // Append to <a-scene>
                    document.querySelector('a-scene').appendChild(entityElement);
                });
            }, (error) => {
                console.error("Error fetching entities from Firebase:", error);
            });
        }

        // Initialize entity fetching after the scene is loaded
        document.querySelector('a-scene').addEventListener('loaded', () => {
            fetchEntitiesFromFirebase();
        });

    </script>



    <script>
        document.getElementById("data-container").style.display = "block";

        // Function to update the latitude and longitude display
        function updateLocationDisplay(latitude, longitude) {
            document.getElementById('userLocation').innerText = 'Your Location: \n Latitude: ' + latitude.toFixed(6) + '\n' + 'Longitude: ' + longitude.toFixed(6);

            // Get the latitude and longitude of the object
            var entity = document.getElementById('entity');
            if (entity) {
                var objectLatLng = entity.getAttribute('gps-entity-place');
                if (objectLatLng) {
                    var objectLatitude = parseFloat(objectLatLng.latitude);
                    var objectLongitude = parseFloat(objectLatLng.longitude);
                    document.getElementById('objectLocation').innerText = 'Object Location: \n Latitude: ' + objectLatitude.toFixed(6) + '\n' + 'Longitude: ' + objectLongitude.toFixed(6);
                }
            }
        }

        // Haversine formula to calculate distance between two coordinates
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = (lat1 * Math.PI) / 180;
            const φ2 = (lat2 * Math.PI) / 180;
            const Δφ = ((lat2 - lat1) * Math.PI) / 180;
            const Δλ = ((lon2 - lon1) * Math.PI) / 180;

            const a =
                Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distance in meters
        }

        // Function to show the proximity message
        function showProximityMessage(message) {
            const proximityDiv = document.getElementById("proximity-message");
            proximityDiv.innerText = message;
            proximityDiv.style.display = "block";
            proximityDiv.style.opacity = "1"; // Fade-in effect
        }

        // Function to hide the proximity message
        function hideProximityMessage() {
            const proximityDiv = document.getElementById("proximity-message");
            proximityDiv.style.opacity = "0"; // Fade-out effect
            setTimeout(() => {
                proximityDiv.style.display = "none";
            }, 500); // Match this timeout with the CSS transition duration
        }

        // Check if user is near any entity
        function checkProximity(userLat, userLon, entities, radius) {
            let isNearAnyEntity = false;
            entities.forEach(entity => {
                const distance = calculateDistance(userLat, userLon, entity.latitude, entity.longitude);
                if (distance <= radius) {
                    isNearAnyEntity = true;
                    showProximityMessage(`You are near ${entity.name}`);
                }
            });

            // Hide the message if the user is not near any entity
            if (!isNearAnyEntity) {
                hideProximityMessage();
            }
        }


        // Define your entities with coordinates and names
        const entities = [
            { name: "Home", latitude: 1.903036, longitude: 102.851962, height: 15 },
            { name: "Jiran", latitude: 1.902846, longitude: 102.851071, height: 15 },
            { name: "Medicine Faculty", latitude: 3.115828, longitude: 101.653418, height: 20 },
            { name: "Engineering Faculty", latitude: 3.117802, longitude: 101.655650, height: 20 },
            { name: "Law Faculty", latitude: 3.118005, longitude: 101.660850, height: 20 },
            { name: "Science Faculty", latitude: 3.121827, longitude: 101.653875, height: 20 },
            { name: "Computer Science Faculty", latitude: 3.127979, longitude: 101.650565, height: 20 },
            { name: "Business and Economics Faculty", latitude: 3.118396, longitude: 101.652676, height: 20 },
            { name: "Arts and Social Sciences Faculty", latitude: 3.120916, longitude: 101.653107, height: 20 },
            { name: "Built Environment Faculty", latitude: 3.115871, longitude: 101.655339, height: 20 },
            { name: "Dentistry Faculty", latitude: 3.111392, longitude: 101.652523, height: 20 },
            { name: "Education Faculty", latitude: 3.119958, longitude: 101.652903, height: 20 },
            { name: "Sports Science Faculty", latitude: 3.130788, longitude: 101.660023, height: 20 },
            { name: "Languages Faculty", latitude: 3.122513, longitude: 101.651525, height: 20 },
            { name: "Pharmacy Faculty", latitude: 3.115517, longitude: 101.652362, height: 20 },
            { name: "Creative Arts Faculty", latitude: 3.118616, longitude: 101.653299, height: 20 },
            { name: "Malay Studies Academy", latitude: 3.125078, longitude: 101.652265, height: 20 },
            { name: "Islamic Studies Academy", latitude: 3.132609, longitude: 101.657780, height: 20 },
            { name: "Institute of Advanced Studies", latitude: 3.124623, longitude: 101.659739, height: 20 },
            { name: "Foundation Centre", latitude: 3.123262, longitude: 101.659417, height: 20 },

            // Residential Colleges
            { name: "Kolej Kediaman 1", latitude: 3.117609, longitude: 101.659361, height: 20 },
            { name: "Kolej Kediaman 2", latitude: 3.118220, longitude: 101.657536, height: 20 },
            { name: "Kolej Kediaman 3", latitude: 3.124310, longitude: 101.650715, height: 20 },
            { name: "Kolej Kediaman 4", latitude: 3.124872, longitude: 101.649416, height: 20 },
            { name: "Kolej Kediaman 5", latitude: 3.127138, longitude: 101.658605, height: 20 },
            { name: "Kolej Kediaman 6", latitude: 3.115498, longitude: 101.654873, height: 20 },
            { name: "Kolej Kediaman 7", latitude: 3.126104, longitude: 101.650415, height: 20 },
            { name: "Kolej Kediaman 8", latitude: 3.129827, longitude: 101.649728, height: 20 },
            { name: "Kolej Kediaman 9", latitude: 3.120319, longitude: 101.646064, height: 20 },
            { name: "Kolej Kediaman 10", latitude: 3.130641, longitude: 101.650468, height: 20 },
            { name: "Kolej Kediaman 11", latitude: 3.129356, longitude: 101.660511, height: 20 },
            { name: "Kolej Kediaman 12", latitude: 3.125649, longitude: 101.660795, height: 20 },
            { name: "Kolej Kediaman 13", latitude: 3.120582, longitude: 101.639610, height: 20 },
            { name: "Rumah Universiti", latitude: 3.122223, longitude: 101.657570, height: 20 },

            // Facilities
            { name: "Dewan Tunku Canselor (DTC)", latitude: 3.121436, longitude: 101.657060, height: 20 },
            { name: "Panggung Seni", latitude: 3.121522, longitude: 101.656079, height: 20 },
            { name: "KPS Complex", latitude: 3.121125, longitude: 101.655145, height: 20 },
            { name: "Bangunan Canseleri", latitude: 3.120445, longitude: 101.657636, height: 20 },
            { name: "Examination Hall", latitude: 3.115147, longitude: 101.658086, height: 20 },
            { name: "UM Central", latitude: 3.120975, longitude: 101.653585, height: 20 },
            { name: "Bank Islam", latitude: 3.122143, longitude: 101.656503, height: 20 },
            { name: "Masjid Universiti", latitude: 3.117938, longitude: 101.662769, height: 20 },
            { name: "Temple", latitude: 3.127944, longitude: 101.660709, height: 20 },

            // Libraries
            { name: "UM Main Library", latitude: 3.120274, longitude: 101.654513, height: 20 },
            { name: "Medical Library", latitude: 3.114301, longitude: 101.653429, height: 20 },
            { name: "Law Library", latitude: 3.118624, longitude: 101.653478, height: 20 },
            { name: "Za'ba Library", latitude: 3.118624, longitude: 101.653478, height: 20 },
            { name: "Dental Library", latitude: 3.115774, longitude: 101.659985, height: 20 },
            { name: "Islamic Studies Library", latitude: 3.132277, longitude: 101.657421, height: 20 },

            // Sports and Recreation
            { name: "UM Wall Squash", latitude: 3.131988, longitude: 101.658011, height: 20 },
            { name: "Varsity Green", latitude: 3.120477, longitude: 101.659148, height: 20 },
            { name: "UM Park", latitude: 3.119047, longitude: 101.660017, height: 20 },
            { name: "Padang C", latitude: 3.120177, longitude: 101.660135, height: 20 },
            { name: "Kayak Centre", latitude: 3.119374, longitude: 101.658671, height: 20 },
            { name: "Swimming Pool", latitude: 3.128806, longitude: 101.659803, height: 20 },
            { name: "UM Sports Centre", latitude: 3.129872, longitude: 101.660018, height: 20 },
            { name: "UM Arena Stadium", latitude: 3.130895, longitude: 101.659690, height: 20 },
            { name: "Rimba Ilmu", latitude: 3.130697, longitude: 101.658203, height: 20 },
            { name: "Ladang Mini", latitude: 3.128190, longitude: 101.660865, height: 20 },
            { name: "Mustafa River", latitude: 3.125919, longitude: 101.658998, height: 20 },
        ];

        // Update the location continuously with system popup for errors
        function updateLocation() {
            navigator.geolocation.watchPosition(
                function (position) {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;

                    // Update the user's location display
                    updateLocationDisplay(latitude, longitude);

                    // Check if the user is near any entity (within a 25-meter radius)
                    checkProximity(latitude, longitude, entities, 30);
                },
                function (error) {
                    // Handle different types of errors and show system alert popup
                    let message = "";
                    switch (error.code) {
                        case 1:
                            message = "Permission denied. Please enable location access in your browser settings.";
                            break;
                        case 2:
                            message = "Position unavailable. Please check your GPS or internet connection.";
                            break;
                        case 3:
                            message = "Request timed out. Please try again.";
                            break;
                        default:
                            message = "An unknown error occurred. Please refresh and try again.";
                            break;
                    }
                    // Display system alert popup
                    alert(message);
                },
                {
                    enableHighAccuracy: true,
                    maximumAge: 0,
                    timeout: 5000
                }
            );
        }

        // Call the function to start updating the location
        updateLocation();


        document.querySelector('a-scene').addEventListener('loaded', function () {
            document.getElementById("Loading").style.display = "none";
        });


        //----------------------------------------------------------------------------------------------------------//
        function showCameraFacingMessage(message) {
            const facingMessageDiv = document.getElementById("camera-facing-message");
            facingMessageDiv.innerText = message;
            facingMessageDiv.style.display = "block";
            facingMessageDiv.style.opacity = "1"; // Fade-in effect
        }

        function hideCameraFacingMessage() {
            const facingMessageDiv = document.getElementById("camera-facing-message");
            facingMessageDiv.style.opacity = "0"; // Fade-out effect
            setTimeout(() => {
                facingMessageDiv.style.display = "none";
            }, 500); // Match this timeout with the CSS transition duration
        }

        function checkCameraFacing(camera, entities) {
            const cameraDirection = new THREE.Vector3();
            camera.object3D.getWorldDirection(cameraDirection);

            const cameraPosition = new THREE.Vector3();
            camera.object3D.getWorldPosition(cameraPosition);

            let isFacingAnyEntity = false;

            entities.forEach(entity => {
                const entityPosition = new THREE.Vector3(
                    entity.longitude, // Placeholder for entity X position
                    entity.height, // Placeholder for Y (height)
                    entity.latitude // Placeholder for entity Z position
                );

                const toEntityDirection = new THREE.Vector3().subVectors(entityPosition, cameraPosition).normalize();

                const dotProduct = cameraDirection.dot(toEntityDirection);

                // Check if camera is pointing towards the entity
                if (dotProduct > 0.95) { // Adjust threshold for precision
                    showCameraFacingMessage(`You are facing ${entity.name}`);
                    isFacingAnyEntity = true;
                }
            });

            if (!isFacingAnyEntity) {
                hideCameraFacingMessage();
            }
        }

        function startCameraFacingCheck() {
            const camera = document.querySelector("a-camera");
            setInterval(() => {
                checkCameraFacing(camera, entities);
            }, 500); // Check every 500ms
        }

        startCameraFacingCheck();


        // Your Mapbox Token
        const MAPBOX_TOKEN = 'sk.eyJ1IjoiaGF6aXFodWR6YWlyeTAyIiwiYSI6ImNtM3VvYzduZDBqazgyanIzOTdibXM1c3IifQ.IRA9AZlLo-eF9uXsQkzdmg';

        // Define start and end points
        const start = [3.129827, 101.649728]; // Example start point
        const end = [3.127979, 101.650565]; // Example end point

        // Fetch route data from Mapbox Directions API
        async function fetchRoute(start, end) {
            const url = `https://api.mapbox.com/directions/v5/mapbox/walking/${start[1]},${start[0]};${end[1]},${end[0]}?geometries=geojson&access_token=${MAPBOX_TOKEN}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.routes && data.routes.length > 0) {
                    return data.routes[0].geometry.coordinates; // Array of waypoints
                } else {
                    console.error("No route found.");
                    return [];
                }
            } catch (error) {
                console.error('Error fetching route:', error);
                return [];
            }
        }

        // Function to interpolate points along the polyline
        function densifyPolyline(polyline, interval) {
            const points = [];
            for (let i = 0; i < polyline.length - 1; i++) {
                const [lon1, lat1] = polyline[i];
                const [lon2, lat2] = polyline[i + 1];
                const segmentPoints = interpolatePoints(lat1, lon1, lat2, lon2, interval); // 1 meter interval
                points.push(...segmentPoints);
            }
            return points;
        }

        // Helper function to interpolate points
        function interpolatePoints(lat1, lon1, lat2, lon2, interval) {
            const points = [];
            const R = 6371e3; // Earth’s radius in meters
            const φ1 = (lat1 * Math.PI) / 180;
            const φ2 = (lat2 * Math.PI) / 180;
            const Δφ = ((lat2 - lat1) * Math.PI) / 180;
            const Δλ = ((lon2 - lon1) * Math.PI) / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c; // Distance in meters

            const steps = Math.ceil(distance / interval); // Number of markers
            for (let i = 0; i <= steps; i++) {
                const fraction = i / steps;
                const lat = lat1 + (lat2 - lat1) * fraction;
                const lon = lon1 + (lon2 - lon1) * fraction;
                points.push([lon, lat]);
            }
            return points;
        }

        // Clear existing markers
        function clearMarkers() {
            const scene = document.querySelector('a-scene');
            scene.querySelectorAll('.route-marker').forEach((marker) => {
                marker.parentNode.removeChild(marker);
            });
        }


        // Render AR markers for the densified route
        async function renderRoute() {
            clearMarkers(); // Clear existing markers for the route

            const route = await fetchRoute(start, end); // Fetch route
            if (!route || route.length === 0) return;

            const densifiedPoints = densifyPolyline(route, 3); // Densify polyline

            // Render markers
            densifiedPoints.forEach(([lon, lat]) => {
                const marker = document.createElement('a-entity');
                marker.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon}`);
                marker.setAttribute('geometry', 'primitive: sphere; radius: 0.5');
                marker.setAttribute('material', 'color: green');
                marker.setAttribute('scale', '0.5 0.5 0.5');
                marker.setAttribute('look-at', '[gps-camera]');
                marker.classList.add('route-marker'); // Add a unique class
                document.querySelector('a-scene').appendChild(marker);
            });

            // Add Start and End labels
            const [startLon, startLat] = route[0];
            const startLabel = document.createElement('a-text');
            startLabel.setAttribute('value', 'Start');
            startLabel.setAttribute('gps-entity-place', `latitude: ${startLat}; longitude: ${startLon}`);
            startLabel.setAttribute('color', 'white');
            startLabel.setAttribute('scale', '10 10 10');
            startLabel.classList.add('route-marker'); // Add a unique class
            document.querySelector('a-scene').appendChild(startLabel);

            const [endLon, endLat] = route[route.length - 1];
            const endLabel = document.createElement('a-text');
            endLabel.setAttribute('value', 'End');
            endLabel.setAttribute('gps-entity-place', `latitude: ${endLat}; longitude: ${endLon}`);
            endLabel.setAttribute('color', 'white');
            endLabel.setAttribute('scale', '10 10 10');
            endLabel.classList.add('route-marker'); // Add a unique class
            document.querySelector('a-scene').appendChild(endLabel);
        }




        // Call the render function after the scene is loaded
        document.querySelector('a-scene').addEventListener('loaded', function () {
            renderRoute(); // Render route markers
        });


    </script>
</body>

</html>