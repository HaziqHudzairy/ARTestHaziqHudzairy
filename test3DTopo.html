<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-Frame Mapbox VR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/keplergl/aframe-mapbox-component/dist/aframe-mapbox-component.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
    <style>
        body {
            margin: 0;
        }

        #joystick-container {
            position: absolute;
            bottom: 50px;
            left: 50px;
            width: 150px;
            height: 150px;
            z-index: 10;
        }
    </style>
</head>

<body>
    <!-- A-Frame Scene -->
    <a-scene>

        <!-- Add a skybox for better visibility -->
    <a-sky color="#ECECEC"></a-sky>

    <!-- Mapbox Map -->
    <a-mapbox
        mapbox-token="pk.eyJ1IjoiamFpcnkxOTExIiwiYSI6ImNsd3dscGdyMDExb3gyaXBncjlydWRzd2sifQ.vllbvi2AvqhKk6KIs85Mtg"
        mapbox-style="mapbox://styles/mapbox/streets-v12"
        center="101.653585,3.120975"
        zoom="150"
        height="10"
        extrude-buildings="true">
    </a-mapbox>

    <!-- Camera -->
    <a-entity id="camera" position="0 10 0" camera look-controls>
        <a-light type="point" position="0 5 0"></a-light>
    </a-entity>

    <!-- Debug Box -->
    <a-box position="0 1 -5" color="red"></a-box>
    </a-scene>

    <!-- Joystick Container -->
    <div id="joystick-container"></div>

    <script>
        // Initialize joystick
        const joystick = nipplejs.create({
            zone: document.getElementById('joystick-container'),
            mode: 'static',
            position: { left: '50%', bottom: '50%' },
            color: 'blue',
            size: 150
        });

        const camera = document.getElementById('camera');
        const movementSpeed = 0.1; // Speed multiplier for joystick movement

        let movementInterval = null;

        // Joystick move event
        joystick.on('move', function (evt, data) {
            if (data.angle && data.distance) {
                const angle = data.angle.degree * (Math.PI / 180); // Convert to radians
                const dx = movementSpeed * Math.sin(angle) * data.distance / 50;
                const dz = movementSpeed * Math.cos(angle) * data.distance / 50;

                // Start moving the camera
                if (!movementInterval) {
                    movementInterval = setInterval(() => {
                        const position = camera.object3D.position;
                        position.x += dx;
                        position.z += dz;
                    }, 16);
                }
            }
        });

        // Stop movement on joystick release
        joystick.on('end', function () {
            if (movementInterval) {
                clearInterval(movementInterval);
                movementInterval = null;
            }
        });
    </script>
</body>

</html>
